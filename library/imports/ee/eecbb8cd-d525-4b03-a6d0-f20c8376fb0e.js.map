{"version":3,"sources":["assets\\scripts\\GameManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Player from \"./Player\"\r\nimport UI from \"./UI\"\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameManager extends cc.Component {\r\n\r\n    @property(Player)\r\n    player1: Player = null;\r\n\r\n    @property(Player)\r\n    player2: Player = null;\r\n\r\n    @property(Player)\r\n    player3: Player = null;\r\n\r\n    @property(UI)\r\n    UI: UI = null;\r\n\r\n    @property(cc.Node)\r\n    camera: cc.Node = null;\r\n\r\n    @property(cc.AudioClip)\r\n    bgm: cc.AudioClip = null;\r\n\r\n    @property(cc.Prefab)\r\n    private groundPrefab: cc.Prefab = null;\r\n\r\n    private player = null;\r\n\r\n    private aKeyDown: boolean = false;\r\n\r\n    private dKeyDown: boolean = false;\r\n\r\n    private shoot: boolean = false;\r\n\r\n    private currPlayer: number;\r\n\r\n    private totalPlayer: number = 3;\r\n\r\n    private shootAngle = null;\r\n\r\n    private groundPool = null;\r\n\r\n    // private currPlayerPos = null;\r\n\r\n    private isPaused: boolean = false;\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        cc.director.getPhysicsManager().gravity = cc.v2(0, -980);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        // this.groundPool = new cc.NodePool('Ground');\r\n        // for(let i: number = 0; i < 9000; i++) {\r\n        //     let ground = cc.instantiate(this.groundPrefab);\r\n\r\n        //     this.groundPool.put(ground);\r\n        // }\r\n    }\r\n    \r\n    start () {\r\n        //this.playBGM();\r\n        // this.createGround();\r\n        this.changePlayer(0);\r\n        this.initResumeBtn();\r\n    }\r\n\r\n    // createGround() {\r\n    //     let ground = null;\r\n    //     let i = 0;\r\n    //     while(this.groundPool.size() > 0) {\r\n    //         ground = this.groundPool.get(this.groundPool);\r\n    //         ground.getComponent('Ground').init(this.node, i);\r\n    //         i++; \r\n    //     }\r\n    // }\r\n\r\n    update (dt) {\r\n        var playerPos = this.player.node.getPosition();\r\n        var cameraPos = this.camera.getPosition();\r\n        cameraPos.lerp(playerPos, 0.1, cameraPos);\r\n        cameraPos.y = cc.misc.clampf(playerPos.y, 0, 200);\r\n        if(cameraPos.x < 0) {\r\n            cameraPos.x = 0;\r\n        } else if(cameraPos.x > 8500) {\r\n            cameraPos.x = 8500;\r\n        }\r\n        this.camera.setPosition(cameraPos);\r\n    }\r\n\r\n    changePlayer(num) {\r\n        this.currPlayer = num % this.totalPlayer;\r\n        if(this.player) {\r\n            this.player.setPlayerMoveDirection(0);\r\n            this.player.setPlayerJump(false);\r\n            this.onDisable();\r\n        } \r\n        switch (this.currPlayer) {\r\n            case 0:\r\n                this.player = this.player1;\r\n                break;\r\n            case 1:\r\n                this.player = this.player2;\r\n                break;\r\n            case 2:\r\n                this.player = this.player3;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        this.onEnable();\r\n    }\r\n\r\n    playBGM() {\r\n        cc.audioEngine.playMusic(this.bgm, true);\r\n    }\r\n\r\n    protected onEnable(): void {\r\n        if(this.player) {\r\n            this.player.node.on(cc.Node.EventType.TOUCH_START, this.onEventStart, this);    // touched\r\n            this.player.node.on(cc.Node.EventType.TOUCH_MOVE, this.onEventMove, this);      // aim\r\n            this.player.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onEventCancel, this);  // shoot\r\n            this.player.node.on(cc.Node.EventType.TOUCH_END, this.onEventEnd, this);        // cancel shoot\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        if(this.player) {\r\n            this.player.node.off(cc.Node.EventType.TOUCH_START, this.onEventStart, this);   // touched\r\n            this.player.node.off(cc.Node.EventType.TOUCH_MOVE, this.onEventMove, this);     // aim\r\n            this.player.node.off(cc.Node.EventType.TOUCH_CANCEL, this.onEventCancel, this); // shoot\r\n            this.player.node.on(cc.Node.EventType.TOUCH_END, this.onEventEnd, this);        // cancel shoot\r\n        }\r\n    }\r\n\r\n    onKeyDown(e) {\r\n        switch (e.keyCode) {\r\n            case cc.macro.KEY.a:        // move left\r\n                this.aKeyDown = true;\r\n                this.player.setPlayerMoveDirection(-1);\r\n                break;\r\n            case cc.macro.KEY.d:        // move right\r\n                this.dKeyDown = true;\r\n                this.player.setPlayerMoveDirection(1);\r\n                break;\r\n            case cc.macro.KEY.space:    // jump\r\n                this.player.setPlayerJump(true);\r\n                break;\r\n            case cc.macro.KEY.escape:\r\n                this.pauseGame();\r\n                //this.UI.pause();\r\n                break;\r\n            case cc.macro.KEY.p:        // pass\r\n                this.changePlayer(this.currPlayer + 1);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onKeyUp(e) {\r\n        switch (e.keyCode) {\r\n            case cc.macro.KEY.a:\r\n                this.aKeyDown = false;\r\n                if(this.dKeyDown) {\r\n                    this.player.setPlayerMoveDirection(1);  // move right\r\n                } else {\r\n                    this.player.setPlayerMoveDirection(0);  // stop moving\r\n                }\r\n                break;\r\n            case cc.macro.KEY.d:\r\n                this.dKeyDown = false;\r\n                if(this.aKeyDown) {\r\n                    this.player.setPlayerMoveDirection(-1); // move left\r\n                } else {\r\n                    this.player.setPlayerMoveDirection(0);  // stop moving\r\n                }\r\n                break;\r\n            case cc.macro.KEY.space:\r\n                this.player.setPlayerJump(false);\r\n                break;\r\n            case cc.macro.KEY.f:        // shoot (bullet)\r\n                this.player.setPlayerShoot();\r\n                break;\r\n            case cc.macro.KEY.r:        // bomb\r\n                this.player.setPlayerBomb(45);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onEventStart (event) {  // touched\r\n        if (!this.enabledInHierarchy) return;\r\n\r\n        if(!this.shoot) {\r\n            // this.startPos = this.node.position;\r\n            // this.motorJoint.enabled = false;\r\n            // this.rb.gravityScale = 0;\r\n            // this.rb.linearVelocity = cc.Vec2.ZERO;\r\n            // this.rb.angularVelocity = 0;\r\n        }\r\n        event.stopPropagation();\r\n    }\r\n    \r\n    onEventMove (event) {   // aim\r\n        if (!this.enabledInHierarchy) return;\r\n    \r\n        if(!this.shoot){\r\n            // count shooting angle in PI\r\n            // var playerPos = cc.v2(this.player.node.position.x + 480, this.player.node.position.y + 320);\r\n            var playerPos = event.getStartLocation();\r\n            var mousePos = event.getLocation();\r\n            var diffX = mousePos.x - playerPos.x;\r\n            var diffY = mousePos.y - playerPos.y;\r\n            // mousePos = this.player.node.parent.convertToNodeSpaceAR(mousePos);\r\n            // var angle = mousePos.signAngle(playerPos);\r\n            // this.shootAngle = Math.atan2(diffX, diffY) * (180/ Math.PI) - 90 * -1;\r\n            // this.shootAngle = Math.atan2(Math.abs(diffY), Math.abs(diffX)) * (180/ Math.PI);\r\n            this.shootAngle = Math.atan2(Math.abs(diffY), Math.abs(diffX));\r\n            // this.shootAngle = Math.atan2(diffY, diffX) * (180/ Math.PI);\r\n\r\n            // change player direction\r\n            if(diffX >= 0) {\r\n                this.player.setPlayerChangeDirection(-1);\r\n            } else {\r\n                this.player.setPlayerChangeDirection(1);\r\n            }\r\n\r\n            // draw trajectory line\r\n            this.player.line.getComponent(\"TrajectoryLine\").drawLine(this.shootAngle);\r\n\r\n            // console.log(angle);\r\n            // console.log(playerPos.x + \" \" + playerPos.y)\r\n            // console.log(mousePos.x + \" \" + mousePos.y);\r\n\r\n            // gagal\r\n            // var pos = this.player.node.getPosition();\r\n            // var angle = pos.angle(event.getLocation());\r\n            // var degr = cc.misc.radiansToDegrees(angle);\r\n            // this.player.node.getjoi\r\n            // console.log(angle)\r\n\r\n            // angry bird\r\n            // if(this.currAngle < 90) {\r\n            //     this.currAngle += 1;\r\n\r\n            // }\r\n            // let start = event.getStartLocation();\r\n            // let cur = event.getLocation();\r\n            // cur.subSelf(start);\r\n            \r\n            // let cur_v = cc.v2(cur.x, cur.y);\r\n            // if(cur_v.mag() > this.maxLength){\r\n            //     cur_v.normalizeSelf().mulSelf(this.maxLength);\r\n            // }\r\n\r\n            // this.node.setPosition(this.startPos.add(cur_v));\r\n            \r\n            // this.rb.linearVelocity = cc.Vec2.ZERO;\r\n            // this.rb.angularVelocity = 0;\r\n        }\r\n\r\n        event.stopPropagation();\r\n    }\r\n\r\n    onEventCancel (event) { // shoot\r\n        if (!this.enabledInHierarchy) return;\r\n\r\n        this.haveShot();\r\n    \r\n        event.stopPropagation();\r\n    }\r\n    \r\n    onEventEnd (event) {  // cancel shoot\r\n        if (!this.enabledInHierarchy) return;\r\n    \r\n        this.haveShot();\r\n    \r\n        event.stopPropagation();\r\n    }\r\n\r\n    haveShot() {\r\n        if(this.shoot) return;\r\n        this.player.line.getComponent(\"TrajectoryLine\").clearLine();\r\n        // this.shoot = true;\r\n        // if(this.shootAngle > 30) {\r\n            this.player.setPlayerBomb(this.shootAngle);\r\n        // }\r\n        this.player.setPlayerChangeDirection(0);\r\n    }\r\n\r\n    pauseGame() {\r\n        if(cc.director.isPaused()) {\r\n            cc.director.resume();\r\n            cc.find(\"Canvas/Main Camera/Pause Menu\").active = false;\r\n        }\r\n        else {\r\n            cc.director.pause();\r\n            cc.find(\"Canvas/Main Camera/Pause Menu\").active = true;\r\n        }\r\n    }\r\n\r\n    // Pause Menu Buttons\r\n\r\n    initResumeBtn() {\r\n        let clickEventHandler = new cc.Component.EventHandler();\r\n        clickEventHandler.target = this.node;\r\n        clickEventHandler.component = \"GameManager\";\r\n        clickEventHandler.handler = \"resume\";\r\n        cc.find(\"Canvas/Main Camera/Pause Menu/resumeBtn\").getComponent(cc.Button).clickEvents.push(clickEventHandler);\r\n    }\r\n\r\n    resume() {\r\n        cc.director.resume();\r\n        cc.find(\"Canvas/Main Camera/Pause Menu\").active = false;\r\n    }\r\n\r\n}\r\n"]}